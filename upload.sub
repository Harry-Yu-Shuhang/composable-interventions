#!/bin/bash
#SBATCH --partition=debug
#SBATCH --job-name=upload_qwen_hf
#SBATCH --nodes=1
#SBATCH --ntasks=1
#SBATCH --cpus-per-task=1
#SBATCH --time=00:10:00
#SBATCH --output=logs/upload_model/upload_output.log
#SBATCH --error=logs/upload_model/upload_output.err

set -e

echo "ğŸ“¦ ä¸Šä¼ ä»»åŠ¡å¼€å§‹: $(date)"

# 1ï¸âƒ£ è®¾ç½®è·¯å¾„
MODEL_DIR="/mnt/fast/nobackup/scratch4weeks/ly0008/ysh/composable-interventions/models/Qwen2.5-32B-Instruct"
KEY_PATH="/vol/research/ly0008/ysh/Shuhang_Private_Key_1"
BRANCH_NAME="main"

# 2ï¸âƒ£ è¿›å…¥æ¨¡å‹ç›®å½•
cd "$MODEL_DIR"

# 3ï¸âƒ£ åˆå§‹åŒ– Gitï¼ˆå¦‚æœè¿˜æ²¡ initï¼‰
if [ ! -d ".git" ]; then
    git init
    git remote add origin git@huggingface.co:HarryYSH/Qwen2.5-32B-Instruct
fi

# 4ï¸âƒ£ ä½¿ç”¨ SSH ç§é’¥æ‰§è¡Œ Git æ“ä½œ
GIT_SSH_COMMAND="ssh -i $KEY_PATH" git add .
GIT_SSH_COMMAND="ssh -i $KEY_PATH" git commit -m "ğŸ”§ Update config and push model"
GIT_SSH_COMMAND="ssh -i $KEY_PATH" git branch -M "$BRANCH_NAME"
GIT_SSH_COMMAND="ssh -i $KEY_PATH" git push -u origin "$BRANCH_NAME"

echo "âœ… æ¨¡å‹ä¸Šä¼ æˆåŠŸ: $(date)"
